<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Working With Vsts Yaml Builds -JustDevOpsStuff(); </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Multi Author Support allows to create articles with different Authors- Working With Vsts Yaml Builds"> <meta name="keywords" content="Working With Vsts Yaml Builds, JustDevOpsStuff();, Azure DevOps,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="JustDevOpsStuff();" property="og:site_name" /> <meta content="Working With Vsts Yaml Builds" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Multi Author Support allows to create articles with different Authors" property="og:description" /> <meta content="/blog/working-with-vsts-yaml-builds/" property="og:url" /> <meta content="2017-12-13T20:05:23+00:00" property="article:published_time" /> <meta content="/about/" property="article:author" /> <meta content="/assets/img/posts/code.jpg" property="og:image" /> <meta content="Azure DevOps" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Working With Vsts Yaml Builds" /> <meta name="twitter:url" content="/blog/working-with-vsts-yaml-builds/" /> <meta name="twitter:description" content="Multi Author Support allows to create articles with different Authors" /> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = '' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- buy me a coffeee --> <!--script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="remcobrilstra" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script--> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">JustDevOpsStuff();</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="/contact" >Contact</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> <span class="snipcart-total-price"></span> </a> </li --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="col-lg-12"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Working With Vsts Yaml Builds</h1> <h4 class="post-meta">Multi Author Support allows to create articles with different Authors</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="/blog/authors/remcobrilstra">remcobrilstra</a></span> </span > at <time datetime="2017-12-13 20:05:23 +0000" itemprop="datePublished" >Dec 13, 2017</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/working-with-vsts-yaml-builds/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/Azure DevOps" >Azure DevOps</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/posts/code.jpg" alt="" /> <br /> <br /> <p>At the Connect(); 2017, Microsoft announced the addition of YAML based build (which I shortly covered in my connect post). Now I finally had some time to play around with this new feature. So I felt it was time go a bit more in-depth on this new system.</p> <p>So I’ll start with an introduction into the subject and walk through getting is all up and running.</p> <h2 id="why-you-want-this">Why you want this</h2> <p>If you have some experience with build systems you will be familiar with the situation where changes in an application require changes to the build process. This is a natural effect of development of any application, but will cause some problems, especially if the changes to the build process are not backwards compatible.</p> <p>In the past (the non-yaml times) this would mean that you would have to create different versions of your build processes for develop and masters branches. In a landscape where you have to be able to build older software versions also, you’d have to create build definition for versions of the application and somehow administrate which build definitions belong to which version of the application. This gets very complicated very fast, not to mention that all these definitions have to be maintained to some extent.</p> <h3 id="yaml-builds-to-the-rescue">YAML builds to the rescue</h3> <p>With the new YAML builds you maintain the build process of your software with the code itself. Meaning it gets checked in with the rest of your code and gets versioned as such. The beauty of this solution is that if you need to build a application version from 2 years ago, you are able to start a build of the related revision and VSTS will fetch the build definition from that point in time and execute that.</p> <p>In the announcement this was referenced to a Pipeline As Code, referring to the similarity to Infrastructure As Code which takes a similar approach to handling Infrastructure. There are many solution for IAC, including but definitely not being limited to Azure Resource Management (ARM).</p> <p>An added advantage (this is true for IAC as well as PAC) is that this puts the responsibility with the programmer to make sure that his/her changes are compliant with the configuration in the repository.</p> <p>A slight disadvantage might be that this does provide yet another way to quite literally break the build, but on the upside it also allows you to fix it.</p> <h2 id="some-critical-notes">Some critical notes</h2> <p>Before we start a short ‘getting started’ guide, there are some things that do (in my humblest of opinions) require some improvement.</p> <h3 id="editing">Editing</h3> <p>Currently there is no editor available for the YAML files. YAML is of course a pretty simple format, but it isn’t always very clear what you are allowed to do. The long way around the seeing if your edit has the desired effect is committing &amp; pushing your updated file and seeing if VSTS gives you any error and/or you build performs as expected. This is a pretty cumbersome process especially when setting up a new build.</p> <p>To make this a bit less straining a ‘View YAML’ button was added to the old build definition which allows you to view the YAML for that build definition. This allows you to setup your build in the normal editing experience then export it to YAML.</p> <p>There is however no way (as far as I know) to easily go from YAML to a editable situation. So say you want to change an existing YAML build you are left to tinker with the file or recreate the YAML build in the editor manually to then apply your change and export it to yaml again. This (especially when your builds get more complex) can be a very labor intensive and error prone operation, so I hope there will be solution of this in the future.</p> <h3 id="just-phases--steps">Just Phases &amp; Steps</h3> <p>It is important to note that the YAML files (currently) only support Phases and Steps. Now there is something to say for this as this is the essence of your build process, however if your build depends on certain variables (something like ‘BuildConfiguration’ or ‘BuildPlatform’) you will have to create them in the VSTS build editor.</p> <p>I do see that advantage of this as it allows you to create different build based on the same process using different trigger/branches or variables. On the other hand it can also cause issues if variables change during the lifetime of the software. You will have to make sure to keep changes here backwards compatible, as something like a missing variable will <em>‘break the build’</em>.</p> <h3 id="yaml">YAML</h3> <p>This is not so much something that I except to be changed just a general wondering ‘WHY YAML?!’. An explanation for this would be that YAML is used for exactly this purpose in other popular build systems, however I would hope that there is a better argument for this then ‘but the other boys are also doing it’.</p> <p>As builds can already be freely exported and imported in JSON it would in my opinion have been a logical choice to reuse this format. This reuse would also have removed the editing issues I stated above as the definition would be easily imported for editing. Which leads me to another possible reason for this choice, as a full export contains way more information then the YAML system currently (and possibly will ever) supports, using a different format does reduce the risk of confusion between the two file-types.</p> <h2 id="getting-started">Getting started</h2> <p>Now that we got that out of the way, lets get this show on the road.</p> <h3 id="enable-the-preview-feature">Enable the preview feature</h3> <p>As this functionality is currently still in preview, it will not be enabled by default. To enable is click your image in the top right corner and click Preview Features. In the panel that shows up make sure to select ‘for this account’ in the drop down as this features can only be enabled for the entire VSTS instance.</p> <p>Now find the ‘Build YAML definitions flag in turn it on.</p> <p><img src="/assets/img/posts/working-with-vsts-yaml-builds/YamlBuildFlag.png" alt="alt text" title="Enabling the preview feature" /></p> <p>Congratulations, you are ready to get started.</p> <h3 id="create-a-standard-build">Create a standard build</h3> <p>Our starting point will be a standard build, for the purposes of this demo I created a ASP.NET Core build and checked in a simple Core web project. But generally any existing build will do.</p> <p><em>For this example I’ll assume that you have an empty project with a core project checked into Git.</em></p> <p>So under <strong>Build and Release / Builds</strong> click the ‘+ New’ button <img src="/assets/img/posts/working-with-vsts-yaml-builds/VSTS_build_selectagentqueu.png" alt="alt text" title="Selecting an agent queue" /></p> <p>Now click the view YAML link in the top right corner of the screen</p> <p><img src="/assets/img/posts/working-with-vsts-yaml-builds/VSTS_View_YAML.png" alt="alt text" title="View YAML" /></p> <h3 id="creating-the-yaml-build">Creating the YAML build</h3> <p>Now copy the YAML from the shown popup and create a file named <strong>.vsts-ci.yml</strong> in the root of your repository. In general the name of this file can be anything you want, however VSTS monitors for this name and whenever there is no existing YAML build looking for this file any commit on the file will trigger the automatic creation of a new build definition based on that file.</p> <p>Once you commit and push this file, you will see a build definition appearing in VSTS, as this build includes a trigger your build will also be running now.</p> <p>Unfortunately the new build will fail ☹</p> <p>As mentioned before variables are not included in the YAML files, however the standard builds use variables (namely like ‘BuildConfiguration’ and ‘BuildPlatform’) which are now missing from our newly created build.</p> <p>To get things working switch to the ‘Variables’ tab and add the missing variables.</p> <p><img src="/assets/img/posts/working-with-vsts-yaml-builds/VSTS_build_set_defaultvariables.png" alt="alt text" title="Add default variables" /></p> <p>Click ‘Save &amp; Queue’ and your build will start, and should succeed</p> <p>Congrats, you just executed your very first YAML based build.</p> <h3 id="another-approach">Another approach</h3> <p>If you want to use a different name and/or create multiple build definitions based on the same YAML file, you can simply use the ‘+ new’ button and select the YAML template.</p> <p><img src="/assets/img/posts/working-with-vsts-yaml-builds/VSTS_build_YAMLdefinition.png" alt="alt text" title="Add default variables" /></p> <p>Under process you will be able to select the YAML file you’d like you use for this build definition.</p> <p><img src="/assets/img/posts/working-with-vsts-yaml-builds/VSTS_build_selectYAMLfile.png" alt="alt text" title="Add default variables" /></p> <p>I hope this gives a clear way to start working with these new builds. if however you are missing anything leave a comment below and I’ll see what I can do.</p> <h2 id="whats-next">Whats next?</h2> <p>As you may know the tasks system that VSTS uses to facilitate build is also used to setup release, however the VSTS team decided to initially only support this feature on the build system. Presumably to give them the time to get this stable before moving further. As stated above there are still some things that might need some TLC before this gets out of preview. However it is a great idea that this functionality will cover releases in the future, as this will allow for maintaining the entire cycle (Build/Release/Infrastructure) from the codebase.</p> <h3 id="sources">Sources</h3> <p>If you want to get into this subject some more, the links below should get in handy.</p> <p>https://github.com/Microsoft/vsts-agent/blob/master/docs/preview/yamlgettingstarted-scripts.md</p> <p>https://docs.microsoft.com/en-us/vsts/build-release/actions/build-yaml</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="/blog/working-with-vsts-yaml-builds/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Remco Brilstra </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="/assets/img/authors/remcobrilstra.png" alt="Remco Brilstra" /> </div> <div class="col-md-6"> <p class="author_bio">Hi I'm Remco, i do DevOps things</p> <p>Email : </p> <p>Website : http://www.remcobrilstra.com</p> <p class="profile-links"> <a class="social-link" href="https://github.com/remcobrilstra" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/remcobrilstra" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/remcobrilstra" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "/blog/working-with-vsts-yaml-builds/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/working-with-vsts-yaml-builds"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Remco Brilstra</div> <div class="card-body"> <p class="author_bio">Hi, my name is Remco Brilstra and i do DevOps things</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#Microsoft Ignite 2017"></div> <li class="tag-head"> <a href="/blog/categories/Microsoft Ignite 2017">Microsoft Ignite 2017</a> </li> <a name="Microsoft Ignite 2017"></a> <div id="#Azure DevOps"></div> <li class="tag-head"> <a href="/blog/categories/Azure DevOps">Azure DevOps</a> </li> <a name="Azure DevOps"></a> <div id="#Azure Cloud"></div> <li class="tag-head"> <a href="/blog/categories/Azure Cloud">Azure Cloud</a> </li> <a name="Azure Cloud"></a> <div id="#Me"></div> <li class="tag-head"> <a href="/blog/categories/Me">Me</a> </li> <a name="Me"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="/">Home</a> </li> <li> <a href="/blog">Blog</a> </li> <li> <a href="/about">About</a> </li> <li> <a href="/contact">Contact</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>.Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script src="/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
